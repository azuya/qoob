!function(){"use strict";function a(a){if(!(a.driver instanceof Object))throw new Error("Driver parameter mast be set!");this.options=a,this.options.skip=a.skip||[];var b=window.location.pathname.replace(/\/.*\..*?$/g,"/");this.options.qoobUrl=this.options.qoobUrl||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+b+(b.indexOf("/",b.length-"/".length)!==-1?"":"/")+"qoob/qoob/",this.options.qoobUrl=this.options.qoobUrl+(this.options.qoobUrl.indexOf("/",this.options.qoobUrl.length-"/".length)!==-1?"":"/"),this.options.skins=this.options.skins||{black:this.options.qoobUrl+"skins/black/skin.js"},this.options.debug=this.options.debug||!1,this.options.mode=this.options.mode||"prod",this.options.skin=this.options.skin||"black",this.options.librariesData=this.options.librariesData||[],this.options.pageData=this.options.pageData||{},window.onload=this.startStage1.bind(this)}a.prototype.loadingProgress=function(a,b,c,d){var e=6,f=100/e,g=this.loader.getCountLoaded()-this.loader.stageLoaded,h=a+b+d+g,i=100*(d+g)/h,j=parseInt((this.loader.stage-1)*f+f/100*i);document.getElementById("qoob_loader_precent").innerHTML=j,document.getElementById("qoob_loader_progressbar").style.width=j+"%",100==j&&this.loadingComplete()},a.prototype.loadingComplete=function(){document.getElementById("qoob_loader_precent").innerHTML=100,document.getElementById("qoob_loader_progressbar").style.width="100%",this.loader.off("progress",this.loadingProgressListener),jQuery("#loader-wrapper").delay(100).fadeOut(1e3,function(){jQuery("#loader-wrapper").remove()})},a.prototype.startStage1=function(){var a=this,b=document.createElement("script");b.setAttribute("type","text/javascript"),b.setAttribute("src",this.options.qoobUrl+"loader.min.js"),b.onload=function(){a.loader=new Loader,a.loader.stage=1,a.loader.stageLoaded=0,a.options.loader=a.loader,a.attachLoaderHTML(),a.loadingProgressListener=a.loadingProgress.bind(a),a.options.loader.on("progress",a.loadingProgressListener);for(var b=0;b<a.options.skip.length;b++)a.loader.loaded[a.options.skip[b]]=1;a.loader.add([{type:"js",name:"jquery",src:a.options.qoobUrl+"libs/jquery.min.js"},{type:"js",name:"underscore",src:a.options.qoobUrl+"libs/underscore.min.js",dep:["jquery"]},{type:"js",name:"backbone",src:a.options.qoobUrl+"libs/backbone-min.js",dep:["jquery","underscore"]},{type:"js",name:"handlebars",src:a.options.qoobUrl+"libs/handlebars.min-latest.js"},{type:"js",name:"handlebars-helper",src:a.options.qoobUrl+"libs/handlebars-helper.js",dep:["handlebars"]}]),a.loader.once("complete",a.startStage2.bind(a)),a.loader.start()},b.onerror=function(){console.error("Can't load loader.js file")},document.head.appendChild(b)},a.prototype.startStage2=function(){var a=this;a.loader.stage=2,a.loader.stageLoaded=a.loader.getCountLoaded(),this.options.driver.loadLibrariesData(function(b,c){if(b)return void console.error("Libraries have been not loaded from driver "+a.options.driver.constructor.name+"."+b);if("undefined"==typeof c)return void console.error("Libraries have been not loaded from driver "+a.options.driver.constructor.name+". Check 'loadLibrariesData' method.");for(var d in c){var e=c[d].url.replace(/\/+$/g,"")+"/";if(c[d].res)for(var f=c[d].res,g=0;g<f.length;g++)f[g].backend&&f[g].backend===!0&&(0!==f[g].src.indexOf("http://")&&0!==f[g].src.indexOf("https://")&&(f[g].src=e+f[g].src.replace(/^\/+/g,"")),a.loader.add(f[g]));var h=c[d].blocks;for(var i in h)h[i].url=h[i].url.replace(/\/+$/g,"")+"/",0!==h[i].url.indexOf("http://")&&0!==h[i].url.indexOf("https://")&&(h[i].url=e+h[i].url),h[i].config_url?0!==h[i].config_url.indexOf("http://")&&0!==h[i].config_url.indexOf("https://")&&(h[i].config_url=e+h[i].config_url.replace(/^\/+/g,"")):h[i].config_url=h[i].url+"config.json",a.loader.add({type:"json",name:c[d].name+"_"+h[i].name,src:h[i].config_url})}a.loader.once("complete",function(){a.options.librariesData=a.parseBlockData(c),a.startStage3()})})},a.prototype.startStage3=function(){var a=this;a.loader.stage=3,a.loader.stageLoaded=a.loader.getCountLoaded(),a.options.driver.loadPageData(function(b,c){a.options.pageData=c,a.startStage4()})},a.prototype.startStage4=function(){var a=this;a.loader.stage=4,a.loader.stageLoaded=a.loader.getCountLoaded(),a.loader.once("complete",function(){window.qoob=new Skin,a.loader.stage=5,a.loader.stageLoaded=a.loader.getCountLoaded(),a.loader.once("complete",function(){a.loader.stage=6,a.loader.stageLoaded=a.loader.getCountLoaded(),a.loader.once("skin_loaded",function(){a.loadingComplete()}),window.qoob.activate(a.options)});var b=a.options.skins[a.options.skin].replace("skin.js","");a.loader.add(window.qoob.assets[a.options.mode],{prefix:b}),a.loader.add(window.qoob.assets.all,{prefix:b})}),a.loader.add({type:"js",src:this.options.skins[this.options.skin],name:"skin"}),a.options.driver.assets&&a.loader.add(a.options.driver.assets)},a.prototype.applyGlobalMask=function(a){var b=function(b){var c=b.replace(/%lib_url\(|\)%\/|%lib_url\(|\)%/g,"").trim(),d=_.findWhere(a,{name:c.trim()});if(d)return d.url},c=function(b){var c,d,g,h,i=b.replace(/%block_url\(|\)%\/|%block_url\(|\)%/g,""),j=i.split(",");if(2===j.length)c=j[0],d=j[1];else{if(1!==j.length)return b;c=e.name,d=j[0]}if(g=_.findWhere(a,{name:c.trim()}))return h=_.findWhere(g.blocks,{name:d}),h?h.url:(console.error("Can't apply mask '"+b+"' for block '"+e.blocks[f].name+"' in lib '"+e.name+"'. Block '"+d+"' not found in '"+c+"'."),b)};for(var d in a){var e=a[d];for(var f in e.blocks){var g=JSON.stringify(a[d].blocks[f].config);g=g.replace(/%lib_url\(.*?\)%\/|%lib_url\(.*?\)%/g,b),g=g.replace(/%block_url\(.*?\)%\/|%block_url\(.*?\)%/g,c),e.blocks[f]=_.extend(JSON.parse(g),e.blocks[f])}}return a},a.prototype.applySelfMask=function(a,b,c){var d=JSON.stringify(a);return d=d.replace(/%lib_url%\/|%lib_url%/g,function(a){return b}),d=d.replace(/%block_url%\/|%block_url%/g,function(a){return c}),JSON.parse(d)},a.prototype.parseBlockData=function(a){var b=[];for(var c in a){var d=a[c];for(var e in d.blocks)this.loader.loaded[d.name+"_"+d.blocks[e].name]?(d.blocks[e].lib=d.name,d.blocks[e].config=this.applySelfMask(this.loader.loaded[d.name+"_"+d.blocks[e].name].data,d.url,d.blocks[e].url)):d.blocks.splice(e,1);b.push(d)}return this.applyGlobalMask(b)},a.prototype.getLoaderHTML=function(){return"<div id='loader-wrapper' style='position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 100500;'><div style='position: relative; height: 668px; top: calc(50% - 150px);'><div class='loading-panel' style='position: relative; text-align: center;'><div class='qoob-preview-img' style='display: block; width: 100%; height: 105px; background: url(\""+this.options.qoobUrl+"qoob_logo.png\") center center no-repeat;'></div><span style='display: inline-block; margin-top: 23px; font-family: \"Helvetica\",Arial,sans-serif; font-size: 14px; color: #2DC0E4; line-height: 20px;'>Loading <span id='qoob_loader_precent'>0</span>%</span><div style='height: 10px; border-radius: 5px; margin-top: 97px; margin-bottom: 102px; margin-left: 15%; margin-right: 15%; box-shadow: none; background: #E2E5E9;'><div id='qoob_loader_progressbar' style='height: 10px; background: #2DC0E4;' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100' style='width:0%;'></div></div></div></div></div>"},a.prototype.attachLoaderHTML=function(){document.body.innerHTML=this.getLoaderHTML()+document.body.innerHTML},window.QoobStarter=a,window.QoobVersion="2.0.0"}();